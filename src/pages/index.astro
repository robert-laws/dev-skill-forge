---
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';
import ProgressSummary from '../components/progress/ProgressSummary.astro';

const modules = (await getCollection('modules')).sort((a, b) => a.data.id - b.data.id);
const groupCount = new Set(modules.map((entry) => entry.data.group)).size;
const withBase = (pathname: string) => `${import.meta.env.BASE_URL}${pathname.replace(/^\//, '')}`;
const homeHeroPhoto = withBase('/images/hero/dev-skill-forge-hero-photo.jpg');
const featuredVisuals = [
  {
    title: 'Specificity Debug Flow',
    description: 'Step through CSS cascade debugging with a visual workflow.',
    src: '/visuals/specificity-debug-flow.svg',
    href: '/modules/debugging-css-specificity'
  },
  {
    title: 'Grid vs Flex Decision Map',
    description: 'Use layout intent to choose the right system quickly.',
    src: '/visuals/grid-flex-decision-map.svg',
    href: '/modules/css-grid-vs-flexbox'
  },
  {
    title: 'Accessibility Audit Loop',
    description: 'Combine automated checks and manual validation effectively.',
    src: '/visuals/a11y-audit-loop.svg',
    href: '/modules/html-accessibility-wcag'
  }
];
---

<BaseLayout
  title="Dev Skill Forge"
  description="Master practical front-end interview topics with 14 focused modules."
>
  <section class="hero">
    <div
      class="hero-photo"
      style={`--hero-photo-image: url('${homeHeroPhoto}');`}
      role="img"
      aria-label="Modern front-end workspace with code on screen, notebooks, and collaborative planning artifacts."
    >
      <p class="hero-kicker">Interview prep with delivery-level realism</p>
    </div>
    <h1>Master real front-end interview topics through focused modules.</h1>
    <p>
      Learn CMS workflows, CSS systems, accessibility, debugging, and professional team practices.
      Every module is built from a high-signal interview question and designed for practical use.
    </p>
    <div class="meta">
      <span>{modules.length} modules</span>
      <span>{groupCount} topic groups</span>
    </div>
  </section>

  <ProgressSummary total={modules.length} />

  <section class="section-block visual-gallery">
    <h2 class="section-title">Learn Visually</h2>
    <p>Each flagship module includes diagrams and interactive walkthroughs to make concepts stick.</p>
    <div class="visual-grid">
      {featuredVisuals.map((item) => (
        <a class="visual-card" href={withBase(item.href)}>
          <img src={withBase(item.src)} alt={item.title} loading="lazy" decoding="async" />
          <h3>{item.title}</h3>
          <p>{item.description}</p>
        </a>
      ))}
    </div>
  </section>

  <section>
    <h2 class="section-title">Start Learning</h2>
    <div class="card-grid">
      {modules.map((module) => (
        <a class="card" href={withBase(`/modules/${module.slug}`)}>
          <span class="badge">Module {module.data.id}</span>
          <h3>{module.data.title}</h3>
          <p>{module.data.group}</p>
          <p class="card-status" data-module-status={module.slug}>Not started</p>
        </a>
      ))}
    </div>
  </section>
</BaseLayout>
